<html>
	<head>
		<title>Team Wishlists</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
		<link rel="icon" href="/favicon-128.png" sizes="128x128">
		<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
		<style>
			html, body { padding:0;margin:0;background:#111;color:#fff;font-family:'Roboto',sans-serif }
			main { width:80%;max-width:980px;margin:20px auto;display:flex;flex-direction:row;flex-wrap:wrap;gap:20px;justify-content:center }
			main div { max-width:440px;flex-grow:1;background:#fff;color:#000;padding:20px;border-radius:20px }
            main h1 { flex-basis:100%;text-align:center }
            h1, h3 { margin:0 }
            ol { padding:20px;margin:0 }
		</style>
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-T7S24X2FST"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'G-T7S24X2FST');
		</script>
	</head>
	<body>
		<main>
            <h1>Peanut Mister Activations Per Team</h1>
        </main>
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/underscore@1.11.0/underscore-min.js"></script>
		<script>
			$(function() {
                loadUpdates();

                function loadUpdates(page) {
                    $.ajax("https://api.sibr.dev/chronicler/v1/games/updates?search=peanut+mister", {
                        method: "GET",
                        data: {
                            "search": "Peanut Mister",
                            "count": 1000,
                            "order": "asc",
                            "page": page
                        },
                        datatype: "json",
                        success: function(data) {
                            _.each(data.data, function(update) {
                                if(!$("[data-id=" + update.data.homeTeam + "]").length) {
                                    $("main").append("<div data-id='" + update.data.homeTeam + "'><h3>" + update.data.homeTeamName + "</h3><ol></ol></div>");
                                }
                                var matcher = update.data.lastUpdate.match(/the peanut mister activates!\s(.+) has been cured of their peanut allergy!/i);
                                if(matcher) {
                                    $("[data-id=" + update.data.homeTeam + "] ol").append("<li>Cured <strong>" + matcher[1] + "</strong> on Season " + (update.data.season + 1)  + " Day " + (update.data.day + 1) + "</li>");
                                }
                                matcher = update.data.lastUpdate.match(/the peanut mister activates!\s(.+) is no longer superallergic!/i);
                                if(matcher) {
                                    $("[data-id=" + update.data.homeTeam + "] ol").append("<li>Removed <strong>Superallergy</strong> from <strong>" + matcher[1] + "</strong> on Season " + (update.data.season + 1)  + " Day " + (update.data.day + 1) + "</li>");
                                }
                            });
                            if(data.nextPage) {
                                loadUpdates(data.nextPage);
                            }
                        },
                        error: function() {
                            handleApiFailure();
                        }
                    });
                }
				
				function handleApiFailure() {
					$("main").empty();
                    $("main").append("<h2>Something went wrong.</h2>")
				}
			});
		</script>
	</body>
</html>